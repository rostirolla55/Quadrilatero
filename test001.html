<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa Interattiva Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase App (compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        #map-container {
            height: 60vh;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .loader-dot {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div class="max-w-4xl mx-auto p-4">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-blue-600">Esplora Luoghi</h1>
            <p class="text-gray-500">Visualizza e salva i tuoi punti di interesse</p>
        </header>

        <!-- Status Bar -->
        <div id="status-bar" class="mb-4 p-3 rounded-lg bg-yellow-100 text-yellow-800 text-sm flex items-center justify-between">
            <span>‚ö†Ô∏è Modalit√† Offline: I dati non verranno salvati sul cloud.</span>
            <button onclick="checkConnection()" class="underline font-bold">Riprova connessione</button>
        </div>

        <!-- Map Placeholder -->
        <div id="map-container" class="shadow-inner border-2 border-dashed border-gray-300">
            <div class="text-center">
                <div class="flex justify-center space-x-2 mb-4">
                    <div class="w-3 h-3 bg-blue-600 rounded-full loader-dot"></div>
                    <div class="w-3 h-3 bg-blue-600 rounded-full loader-dot" style="animation-delay: 0.2s"></div>
                    <div class="w-3 h-3 bg-blue-600 rounded-full loader-dot" style="animation-delay: 0.4s"></div>
                </div>
                <p class="text-gray-400">Caricamento mappa in corso...</p>
            </div>
        </div>

        <!-- Controls -->
        <div class="mt-6 grid grid-cols-2 gap-4">
            <button id="nearbyPoiButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-all shadow-lg active:scale-95">
                üìç Punti Vicini
            </button>
            <button id="addLocationBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl transition-all shadow-lg active:scale-95">
                ‚ûï Aggiungi Posto
            </button>
        </div>

        <!-- List -->
        <div class="mt-8">
            <h2 class="text-xl font-semibold mb-4">I tuoi luoghi salvati</h2>
            <ul id="location-list" class="space-y-2">
                <li class="p-4 bg-white rounded-lg shadow-sm border border-gray-100 text-gray-400 italic text-center">
                    Nessun luogo salvato al momento.
                </li>
            </ul>
        </div>
    </div>

    <script>
        // CONFIGURAZIONE AUTOMATICA (Non toccare queste variabili)
        const appConfig = {
            isFirebaseReady: false,
            db: null
        };

        // Inizializzazione sicura di Firebase
        function initBackend() {
            try {
                // Configurazione dummy per evitare crash se l'utente non ha i dati
                const firebaseConfig = {
                    apiKey: "AIzaSyDummyKey",
                    authDomain: "demo-app.firebaseapp.com",
                    projectId: "demo-app"
                };

                // Inizializziamo solo se i dati sembrano validi (non sono quelli di default)
                if (firebaseConfig.apiKey !== "INSERISCI_QUI_LA_TUA_KEY") {
                    firebase.initializeApp(firebaseConfig);
                    appConfig.db = firebase.firestore();
                    appConfig.isFirebaseReady = true;
                    updateStatus("‚úÖ Connesso al Cloud", "bg-green-100", "text-green-800");
                }
            } catch (e) {
                console.warn("Backend non configurato. L'app user√† la memoria locale.");
            }
        }

        function updateStatus(text, bgColor, textColor) {
            const bar = document.getElementById('status-bar');
            bar.className = `mb-4 p-3 rounded-lg ${bgColor} ${textColor} text-sm flex items-center justify-between transition-colors`;
            bar.innerHTML = `<span>${text}</span>`;
        }

        // Gestione degli eventi dei bottoni
        function setupUI() {
            const nearbyBtn = document.getElementById('nearbyPoiButton');
            const addBtn = document.getElementById('addLocationBtn');

            if (nearbyBtn) {
                nearbyBtn.addEventListener('click', () => {
                    console.log("Ricerca POI avviata...");
                    alert("Ricerca dei punti di interesse vicini attivata!");
                });
            }

            if (addBtn) {
                addBtn.addEventListener('click', () => {
                    const place = prompt("Nome del luogo:");
                    if (place) addLocationToList(place);
                });
            }
        }

        function addLocationToList(name) {
            const list = document.getElementById('location-list');
            if (list.querySelector('li.italic')) list.innerHTML = ''; // Rimuove il messaggio vuoto
            
            const li = document.createElement('li');
            li.className = "p-4 bg-white rounded-lg shadow-sm border-l-4 border-blue-500 flex justify-between items-center";
            li.innerHTML = `
                <span class="font-medium">${name}</span>
                <span class="text-xs text-gray-400">Salvato in locale</span>
            `;
            list.prepend(li);
        }

        // Simulazione caricamento mappa
        function loadMapSimulation() {
            setTimeout(() => {
                const mapContainer = document.getElementById('map-container');
                mapContainer.innerHTML = `
                    <div class="w-full h-full bg-blue-50 flex items-center justify-center border-2 border-blue-200">
                        <div class="text-center">
                            <span class="text-5xl">üó∫Ô∏è</span>
                            <p class="mt-2 font-bold text-blue-800">Mappa Pronta</p>
                            <p class="text-xs text-blue-600">(Simulazione Interfaccia)</p>
                        </div>
                    </div>
                `;
                mapContainer.classList.remove('border-dashed');
            }, 2000);
        }

        // Avvio applicazione
        window.onload = () => {
            initBackend();
            setupUI();
            loadMapSimulation();
        };
    </script>
</body>
</html>